# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the @depot/web package.

## Package Overview

The @depot/web package is a React Progressive Web App (PWA) that displays Warhammer 40K game data processed by @depot/cli. It provides an offline-capable interface for browsing factions, datasheets, stratagems, and other game content.

## Development Commands

### Development Server
```bash
pnpm start
# or from package directory
pnpm run start
```

### Build for Production
```bash
pnpm build
# or from package directory
pnpm run build
```

### Testing
```bash
pnpm test
# or from package directory
pnpm run test
```

### Code Quality
```bash
# Lint with TypeScript check
pnpm run lint

# Format code
pnpm run format
```

## Architecture

### Technology Stack
- **React 19** with React Router DOM for navigation
- **Context + useReducer** for global state management
- **IndexedDB** for offline-first data storage and caching
- **Tailwind CSS v4** for utility-first styling
- **Custom UI Library** in `src/components/ui/`
- **Vite** for build tooling and development server
- **Vite PWA Plugin** for offline functionality

### Application Structure

#### Route-Based Architecture
- `/` - Home page with faction selection
- `/faction/:id` - Faction overview with datasheets, stratagems, etc.
- `/faction/:factionId/datasheet/:id` - Individual datasheet details
- `/settings` - User preferences (show Forge World, Legends content)

#### State Management
See `src/contexts/CLAUDE.md` for detailed context architecture.

- **App Context**: Global state for data index, faction cache, and settings
- **Layout Context**: UI state management (sidebar, responsive behavior)
- **Toast Context**: Notification system with auto-dismiss functionality
- **IndexedDB Storage**: Primary storage for faction data, index, and settings (offline-first)

#### Page Architecture
See `src/pages/CLAUDE.md` for detailed page implementation patterns.

- **Page Components**: Route-specific containers with component breakdown
- **Utility Functions**: Business logic extracted to testable utilities
- **Comprehensive Testing**: Full test coverage with centralized utilities

#### Component Library
Custom Tailwind-based component library in `src/components/ui/`:
- Button, IconButton, Card, Grid, Layout
- Field, SelectField, Search, Filters
- Loader, Toast, ToastContainer
- Dark mode support and responsive design

### Data Flow (Offline-First)
```
IndexedDB ──→ App Context ──→ React Components
   ↑               ↓
   └─ Static JSON Files (network fallback)
   
Settings: IndexedDB ←→ App Context ←→ Settings Page
Faction Data: IndexedDB → App Context → Faction Pages
             (Auto-cached from network when visited)
```

### PWA Features
- **Offline Support**: Service worker caches static assets and data files
- **App Manifest**: Installable as native-like app experience
- **Icon Assets**: Full set of platform-specific icons in `public/`
- **Responsive Design**: Mobile-first approach with desktop enhancements

### Testing Infrastructure
See `src/test/CLAUDE.md` for comprehensive testing guidelines.

- **TestWrapper**: Centralized test wrapper with all required providers
- **Mock Data**: Factory functions for consistent test data
- **React 19 Compliance**: Proper act() patterns for user interactions

### Type System
Uses shared `@depot/core` types with web-specific additions:
- `depot.Settings` interface for user preferences
- Component prop interfaces
- Vite environment types (`types/vite-env.d.ts`)

## Data Requirements

The web app expects processed data files in `public/data/`:
- `index.json` - Faction index for navigation
- `{factionId}.json` - Individual faction data files
- Generated by running `pnpm --filter @depot/cli start`