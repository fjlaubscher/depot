# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the @depot/web package.

## Package Overview

The @depot/web package is a React Progressive Web App (PWA) that displays Warhammer 40K game data processed by @depot/cli. It provides an offline-capable interface for browsing factions, datasheets, stratagems, and other game content.

## Development Commands

### Development Server
```bash
pnpm start
# or from root
pnpm --filter @depot/web start

# Development only (requires existing data)
pnpm dev
# or from root  
pnpm --filter @depot/web dev
```

### Build for Production
```bash
pnpm build
# or from root
pnpm --filter @depot/web build
```

This runs: `pwa-assets-generator` → `tsc` → `vite build`

### Testing
```bash
pnpm test
# or from root
pnpm --filter @depot/web test
```

### Other Commands
```bash
pnpm format          # Format code
pnpm lint            # Lint with TypeScript check
pnpm typecheck       # TypeScript checking only
pnpm clean           # Clean build artifacts
pnpm preview         # Preview built application
pnpm generate-pwa-assets  # Generate PWA icons/assets
```

## Architecture

### Technology Stack
- **React 19** with React Router DOM v7 for navigation
- **Context + useReducer** for global state management
- **IndexedDB** for offline-first data storage and caching
- **Tailwind CSS v4** with PostCSS for utility-first styling
- **Custom UI Library** in `src/components/ui/`
- **Vite 6** for build tooling and development server
- **Vite PWA Plugin** for offline functionality
- **Vitest** for testing with React Testing Library

### Application Structure

#### Route-Based Architecture
- `/` - Dashboard/home page with user overview and quick access
- `/factions` - Faction selection page with all available factions
- `/faction/:id` - Faction overview with datasheets, stratagems, etc.
- `/faction/:factionId/datasheet/:id` - Individual datasheet details
- `/settings` - User preferences (show Forge World, Legends content)

#### State Management
See `src/contexts/CLAUDE.md` for detailed context architecture.

- **App Context**: Global state for data index, faction cache, and settings
- **Layout Context**: UI state management (sidebar, responsive behavior)
- **Toast Context**: Notification system with auto-dismiss functionality
- **IndexedDB Storage**: Primary storage for faction data, index, and settings (offline-first)

#### Page Architecture
See `src/pages/CLAUDE.md` for detailed page implementation patterns.

- **Page Components**: Route-specific containers with component breakdown
- **Utility Functions**: Business logic extracted to testable utilities
- **Comprehensive Testing**: Full test coverage with centralized utilities

#### Component Library
Custom Tailwind-based components in `src/components/ui/` with dark mode support and responsive design.

### Data Flow (Offline-First)
```
IndexedDB ──→ App Context ──→ React Components
   ↑               ↓
   └─ Static JSON Files (network fallback)
   
Settings: IndexedDB ←→ App Context ←→ Settings Page
Faction Data: IndexedDB → App Context → Faction Pages
             (Auto-cached from network when visited)
```

### PWA Features
- **Offline Support**: Service worker caches static assets and data files
- **App Manifest**: Installable as native-like app experience
- **Icon Assets**: Full set of platform-specific icons in `public/`
- **Responsive Design**: Mobile-first approach with desktop enhancements

### Testing Infrastructure
See `src/test/CLAUDE.md` for comprehensive testing guidelines.

- **TestWrapper**: Centralized test wrapper with all required providers
- **Mock Data**: Factory functions for consistent test data
- **React 19 Compliance**: Proper act() patterns for user interactions

### Type System
Uses shared `@depot/core` types with web-specific additions:
- `depot.Settings` interface for user preferences
- Component prop interfaces
- Vite environment types (`types/vite-env.d.ts`)

## Data Requirements

The web app expects processed data files in `public/data/`:
- `index.json` - Faction index for navigation
- `{factionId}.json` - Individual faction data files
- Generated by running `pnpm --filter @depot/cli start`