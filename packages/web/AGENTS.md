# Web Package

React PWA that displays Warhammer 40K data generated by the CLI. The app is offline-first (IndexedDB cache) and ships via Vite.

## Key Commands
- `pnpm --filter @depot/web dev` - start the PWA locally (expects data already in `public/data`)
- `pnpm start` - build core+cli, generate data, copy assets, then start the web dev server
- `pnpm --filter @depot/web build` - production build
- `pnpm --filter @depot/web preview` - preview production build
- `pnpm --filter @depot/web test` / `test:ci` - Vitest
- `pnpm --filter @depot/web format` / `lint` / `typecheck` / `clean` - quality and maintenance
- `pnpm --filter @depot/web generate-pwa-assets` - regenerate PWA icons

## Stack
- React 19 + React Router DOM v7
- Vite 6 + TypeScript 5.9
- Tailwind CSS v4 (@utility tokens in `src/styles/main.css`)
- IndexedDB for offline storage
- Vitest + Testing Library

## Styling Guidelines
- Lean on shared utilities in `src/styles/main.css` (`text-foreground`, `surface-card`, status palettes, `focus-ring-*`) before adding raw Tailwind colors.
- Avoid margins where possible; prefer flex/grid `gap` for spacing. When using `gap` or `padding`, stick to the token set: `*-0.5`, `*-1`, `*-2`, `*-4` and only occasionally `*-6`.
- When a layout/color/focus trio repeats, promote it to an `@utility` entry so JSX stays concise and consistent.
- Order classes structural -> color -> interaction to keep merges predictable.

## Key Routes
- `/` - Home dashboard
- `/factions` - Browse all factions
- `/faction/:factionSlug` - Faction overview
- `/faction/:factionSlug/datasheet/:datasheetSlug` - Datasheet details
- `/collections` - Collections list
- `/collections/create` - Create collection wizard
- `/collections/:collectionId` - Collection details
- `/collections/:collectionId/add-units` - Add units to collection
- `/collections/:collectionId/new-roster` - Create a new roster from a collection
- `/collections/:collectionId/units/:unitId/edit` - Edit a collection unit
- `/rosters` - Saved roster list
- `/rosters/create` - Create roster wizard
- `/rosters/:rosterId` - Read-only roster
- `/rosters/:rosterId/details` - Roster details summary view
- `/rosters/:rosterId/edit` - Roster editor
- `/rosters/:rosterId/add-units` - Datasheet picker
- `/rosters/:rosterId/units/:unitId/edit` - Unit loadout editor
- `/settings`, `/about`, `/privacy`, `/not-found` (`*`)

## Architecture
- **State management**: App (Factions + Settings), Layout, Toast, and Roster contexts (Context + `useReducer`).
- **Data flow**: Load JSON from `public/data/` -> cache in IndexedDB -> serve via contexts/hooks.
- **Directory structure**:
  - `components/` - UI + domain components
  - `contexts/` - React contexts
  - `routes/` - Route-aligned views with `_components` and `_utils`
  - `hooks/` - Shared hooks
  - `utils/` - UI-only helpers (styles, browser-specific behavior, absolute URL wrappers)
  - `styles/` - Global Tailwind config and utilities
- **Shared logic**: All data normalization/filtering/grouping lives in `@depot/core/src/utils`. Import from `@depot/core/utils/{common,datasheets,wargear,...}` rather than keeping copies under `packages/web/src/utils`.

## Key Utilities + Hooks
- `@depot/core/utils/common`: shared slug, keyword grouping, enhancement, breadcrumb, and sorter helpers.
- `@depot/core/utils/{datasheets,wargear,abilities,roster,collection,paths}`: canonical normalization + data builders used by hooks/routes.
- `src/utils/`: UI-specific wrappers only (e.g., ability tag styling, `buildAbsoluteUrl` which reads browser env).
- `hooks/`: datasheet browser, debounce, faction loaders, roster selection, scroll collapse, select, etc.
- `data/offline-storage.ts`: IndexedDB persistence layer

## Data Requirements
- `public/data/index.json` - navigation index produced by `@depot/cli`
- `public/data/{factionSlug}.json` - faction payloads
- Run `pnpm --filter @depot/cli start` (or root `pnpm start`/`pnpm build`) to regenerate data.

## Testing Notes
- Prefer targeted runs: `pnpm --filter @depot/web test -- src/routes/home/index.test.tsx`.
- All route/component tests should prefer `TestWrapper` (`src/test/test-utils.tsx`) to get a MemoryRouter + App, Layout, and Toast providers; add RosterProvider explicitly in tests that exercise roster flows.
- New UI primitives should be covered by focused tests; route/layout changes must update colocated `index.test.tsx` so vitest catches regressions (hero CTAs, quick actions, empty states).
- If a test only exercises shared logic, move it into `packages/core` next to the helper so CLI + web stay in sync.
