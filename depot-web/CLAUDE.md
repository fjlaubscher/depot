# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with the depot-web package.

## Package Overview

The depot-web is a React Progressive Web App (PWA) that displays Warhammer 40K game data processed by depot-cli. It provides an offline-capable interface for browsing factions, datasheets, stratagems, and other game content.

## Development Commands

### Development Server
```bash
yarn start
# or from root
yarn workspace depot-web run start
```

### Build for Production
```bash
yarn build
# or from root
yarn workspace depot-web run build
```

### Testing
```bash
yarn test
# or from root
yarn workspace depot-web test
```

### Code Quality
```bash
# Lint with TypeScript check
yarn lint

# Format code
yarn format
```

## Architecture

### Technology Stack
- **React 18** with React Router DOM for navigation
- **Recoil** for global state management
- **Vite** for build tooling and development server
- **SCSS Modules** for component styling
- **@fjlaubscher/matter** for UI components and utilities
- **Vite PWA Plugin** for offline functionality

### Application Structure

#### Route-Based Architecture
- `/` - Home page with faction selection
- `/faction/:id` - Faction overview with datasheets, stratagems, etc.
- `/faction/:factionId/datasheet/:id` - Individual datasheet details
- `/settings` - User preferences (show Forge World, Legends content)

#### State Management Pattern
- **Recoil Atoms**: Global state for data index and faction data
- **Data Provider**: Wraps app to load initial data from `/data/index.json`
- **Local Storage**: Persists user settings via `@fjlaubscher/matter` hook
- **IndexedDB**: Client-side caching for faction data (optional offline storage)

#### Component Architecture
- **Page Components**: Route-specific containers (`pages/`)
- **Reusable Components**: Cards, tables, filters, buttons (`components/`)
- **SCSS Modules**: Component-scoped styling with `.module.scss` files
- **Layout Component**: Consistent app shell with navigation

### Key Components

#### Data Provider (`components/data-provider/`)
- Fetches faction index on app load
- Manages loading states and data availability
- Integrates with Recoil state atoms
- Handles initial settings configuration

#### Faction Pages (`pages/faction/`)
- Lazy loads faction-specific data from `/data/{factionId}.json`
- Tabbed interface for datasheets, stratagems, psychic powers, etc.
- Filtering and search functionality
- Settings-aware content display (Forge World/Legends filtering)

#### Datasheet Pages (`pages/datasheet/`)
- Detailed unit information display
- Profile tables for models and wargear
- Associated stratagems and abilities
- Mobile-optimized responsive design

### Data Flow

```
Static JSON Files → Data Provider → Recoil State → React Components
                                           ↓
                   IndexedDB (optional caching) ← User Interactions
```

### PWA Features
- **Offline Support**: Service worker caches static assets and data files
- **App Manifest**: Installable as native-like app experience
- **Icon Assets**: Full set of platform-specific icons in `public/`
- **Responsive Design**: Mobile-first approach with desktop enhancements

### Type System
Uses shared `types/depot.d.ts` with web-specific additions:
- `depot.Settings` interface for user preferences
- Component prop interfaces
- Vite environment types (`types/vite-env.d.ts`)

### Build Configuration
- **Vite Config** (`vite.config.ts`): React plugin + PWA configuration  
- **TypeScript**: Strict mode with path resolution
- **SCSS**: Global styles + module system
- **Asset Optimization**: Icon generation and static file handling

## Data Requirements

The web app expects processed data files in `public/data/`:
- `index.json` - Faction index for navigation
- `{factionId}.json` - Individual faction data files
- Generated by running `yarn workspace depot-cli start`